<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link href="./style/reset.css" rel="stylesheet" type="text/css" />
    <link href="./style/main.css" rel="stylesheet" type="text/css" />
    <script src="./js/jquery-1.8.3.min.js"></script>
    <script src="./js/pixi.min.js"></script>

    <script src="./js/echarts.common.min.js"></script>
    <title>每个孩子都是父母眼中最亮的星星</title>
    <style>
        html {
            margin: 0;
            padding: 0;
        }

        body {
            margin: 0;
            padding: 0;
        }

        #stage1,
        #stage2,
        #stage3 {
            height: 100vh;
            width: 100vw;
            position: relative;
            overflow: hidden;
        }

        .stage1-bottom {
            display: flex;
            justify-content: center;
        }

        #stage1 .stage1-button {
            position: absolute;
            bottom: 100px;
            width: 100px;
            height: 50px;
            border-radius: 5px;
            background-color: antiquewhite;
            text-align: center;
        }

        .no-show {
            display: none;
        }

        .progress-aim {

            border-radius: .1rem;
            background-image: -moz-linear-gradient(#fff 0, #2466d4 10%, #fff);
            background-image: -webkit-gradient(linear, 0 0, 0 100%, color-stop(0, #fff), color-stop(0.1, #2466d4), color-stop(1, #fff));
            background-image: -o-linear-gradient(#2466d4, #fff);
            background-image: -ms-linear-gradient(#2466d4, #fff);
            background-image: linear-gradient(to right, #2466d4, #fff);
            position: absolute;

        }

        .stage1-text1,
        .stage1-text2,
        .stage2-text1 {
            text-align: center;
            color: #fff;
            font-weight: 700;
            font-size: 1.5rem;
            position: absolute;
            width: 100%;
        }

        .stage2-text1 {
            text-align: center;
            font-weight: 400;
            opacity: 0;
            /*调用名称为fade-in的动画，全程动画显示时间4S，进入方式为ease，延时0S进入，播放次数1次*/
            animation: fade-in 4s ease 0s 1;
            /*规定动画的最后状态为结束状态*/
            animation-fill-mode: forwards;
            font-size: 16px;
            color: #FFFFFF;
            text-align: center;
            line-height: 28px;
            text-shadow: 0 1px 1px rgba(43, 52, 81, 0.50);
        }

        .stage2-robot {
            position: absolute;
            width: 200px;
            height: 300px;
            right: 24px;
            bottom: 50px;
            background-image: url('./imgs/scene2/robot.gif');
            background-size: contain;
            background-repeat: no-repeat;
        }

        .stage2-dialog {
            background-color: rgba(68, 16, 255, 0.3);
            border: 1px solid #fff;
            width: 285px;
            height: 100px;
            border-radius: 10px;
            position: absolute;
            padding: 3.4% 3.6%;
            box-sizing: border-box;

        }

        .stage2-dialog-text {
            font-size: 16px;
            color: #FFFFFF;
            line-height: 24px;
            text-shadow: 0 1px 1px rgba(43, 52, 81, 0.50);
            font-weight: 400;
        }

        .stage2-dialog:after {
            content: '';
            position: absolute;
            top: 100%;
            right: 0px;
            width: 16px;
            height: 16px;
            border-width: 0;
            border-style: solid;
            border-color: transparent;
            border-left-width: 10px;
            border-left-color: currentColor;
            border-radius: 0 0 0 32px;
            color: rgba(68, 16, 255, 0.3);
        }

        .stage3-text1 {
            position: absolute;
            text-align: center;
            width: 100%;
            font-weight: 400;
            opacity: 0;

            font-size: 16px;
            color: #FFFFFF;
            text-align: center;
            line-height: 28px;
            text-shadow: 0 1px 1px rgba(43, 52, 81, 0.50);
        }

        .stage4-text1 {
            position: absolute;
            text-align: center;
            width: 100%;
            font-weight: 400;
            opacity: 0;
            /*调用名称为fade-in的动画，全程动画显示时间4S，进入方式为ease，延时0S进入，播放次数1次*/
            animation: fade-in 4s ease 0s 2;
            /*规定动画的最后状态为结束状态*/
            animation-fill-mode: forwards;
            font-size: 16px;
            color: #FFFFFF;
            text-align: center;
            line-height: 28px;
            text-shadow: 0 1px 1px rgba(43, 52, 81, 0.50);
        }

        .stage5-text1 {
            position: absolute;
            text-align: center;
            width: 100%;
            font-weight: 400;
            opacity: 0;
            /*调用名称为fade-in的动画，全程动画显示时间4S，进入方式为ease，延时0S进入，播放次数1次*/
            animation: fade-in 4s ease 0s 2;
            /*规定动画的最后状态为结束状态*/
            animation-fill-mode: forwards;
            font-size: 16px;
            color: #FFFFFF;
            text-align: center;
            line-height: 28px;
            text-shadow: 0 1px 1px rgba(43, 52, 81, 0.50);
        }

        .stage6-text1 {
            position: absolute;
            text-align: center;
            width: 100%;
            font-weight: 400;
            opacity: 0;
            /*调用名称为fade-in的动画，全程动画显示时间4S，进入方式为ease，延时0S进入，播放次数1次*/
            animation: fade-in 4s ease 0s 2;
            /*规定动画的最后状态为结束状态*/
            animation-fill-mode: forwards;
            font-size: 16px;
            color: #FFFFFF;
            text-align: center;
            line-height: 28px;
            text-shadow: 0 1px 1px rgba(43, 52, 81, 0.50);
        }

        .stage7-text1 {
            position: absolute;
            text-align: center;
            width: 100%;
            font-weight: 400;
            opacity: 0;
            /*调用名称为fade-in的动画，全程动画显示时间4S，进入方式为ease，延时0S进入，播放次数1次*/
            animation: fade-in 4s ease 0s 2;
            /*规定动画的最后状态为结束状态*/
            animation-fill-mode: forwards;
            font-size: 16px;
            color: #FFFFFF;
            text-align: center;
            line-height: 28px;
            text-shadow: 0 1px 1px rgba(43, 52, 81, 0.50);
        }

        .stage8-text1 {
            position: absolute;
            text-align: center;
            width: 100%;
            font-weight: 400;
            opacity: 0;
            /*调用名称为fade-in的动画，全程动画显示时间4S，进入方式为ease，延时0S进入，播放次数1次*/
            animation: fade-in 4s ease 0s 2;
            /*规定动画的最后状态为结束状态*/
            animation-fill-mode: forwards;
            font-size: 16px;
            color: #FFFFFF;
            text-align: center;
            line-height: 28px;
            text-shadow: 0 1px 1px rgba(43, 52, 81, 0.50);
        }

        .stage3-echarts {
            position: absolute;
        }

        .logo-left {
            position: absolute;
            background-image: url('./imgs/scene1/logo-left@2x.png');
            background-repeat: no-repeat;
            background-size: contain;
            left: 20px;
            top: 26px;
            height: 26px;
            width: 158px;
            z-index: 10;
        }

        .logo-right {
            position: absolute;
            background-image: url('./imgs/scene1/logo-right@2x.png');
            background-repeat: no-repeat;
            background-size: contain;
            right: 20px;
            top: 26px;
            height: 26px;
            width: 116px;
            z-index: 10;
        }

        @keyframes fade-in {
            0% {
                opacity: 0;
            }

            100% {
                opacity: 1;
            }
        }
    </style>
</head>

<body>
    <div class="logo-left"></div>
    <div class="logo-right"></div>
    <div id="stage1">
        <div class="stage1-text1">正在穿越中...</div>
        <div class="stage1-text2"></div>
    </div>

    <div id="stage2" class="no-show">
        <div class="stage2-text1 no-show"></div>
        <div class="stage2-dialog no-show">
            <p class="stage2-dialog-text"></p>
        </div>
    </div>

    <div id="stage3" class="no-show">
        <div class="stage3-text1 no-show"></div>
        <div class="stage3-echarts no-show"></div>
    </div>

    <div id="stage4" class="no-show">
        <div class="stage4-text1 no-show"></div>

    </div>

    <div id="stage5" class="no-show">
        <div class="stage5-text1 no-show"></div>
    </div>


    <div id="stage6" class="no-show">
        <div class="stage6-text1 no-show"></div>
    </div>

    <div id="stage7" class="no-show">
        <div class="stage7-text1 no-show"></div>
    </div>

    <div id="stage8" class="no-show">
        <div class="stage8-text1 no-show"></div>
    </div>

    <div id="stage9" class="no-show">

    </div>
</body>

<script>
    console.log(window.devicePixelRatio)

    let Application = PIXI.Application,
        loader = PIXI.loader,
        resources = PIXI.loader.resources,
        Sprite = PIXI.Sprite;

    //Create a Pixi Application
    let app = null
    let state = 'sence1_start'


    let scene1_imgs = [
        'imgs/scene1/bg@2x.png',
        'imgs/scene1/button@1x.png',
        'imgs/scene1/title@2x.png',
        'imgs/scene1/Light.gif',
    ]
    let light_imgs = []
    for (let i = 0; i < 30; i++) {
        let temp = i.toString()
        if (i < 10) {
            temp = '0' + temp
        }
        light_imgs.push('imgs/scene1/1-Light.png_000' + temp + '.png')
    }
    // 图片资源地址
    let all_imgs = []
    let transfer_1to2 = []

    let [img_width, img_height] = [780, 640]
    PIXI.loader
        .add(scene1_imgs)
        .add(light_imgs)
        .load(setup);
    let [width, height] = [0, 0]
    let flag = '0'
    let [progress_dynamic, progress, cloud_left, cloud_right, login_button] = [null, null, null, null, null]
    let canTouch = false
    let timer_dynamic = null
    function setup() {

        width = document.getElementById('stage1').clientWidth
        height = document.getElementById('stage1').clientHeight
        // 进度条宽度
        let progress_width = parseInt(width * 0.6)
        let offsetLeft = (img_width - width) / 2
        let offsetTop = (img_height - height) / 2
        offsetLeft = parseInt(offsetLeft)
        offsetTop = parseInt(offsetTop)


        app = new PIXI.Application({
            width: width,
            height: height,
            // resizeTo: window.devicePixelRatio,
            resolution: 2,
            antialias: true,
        })
        app.renderer.autoDensity = true;
        app.renderer.resize(width, height);


        // 
        let spriteGroupSences = new PIXI.Container()
        spriteGroupSences.position.set(0, 0)
        spriteGroupSences.name = 'spriteGroupSences'
        app.stage.addChild(spriteGroupSences)
        let sence1 = new PIXI.Container()
        sence1.name = 'sence1'
        sence1.position.set(0, 0)

        let sence2 = new PIXI.Container()
        sence2.position.set(0, 0)
        sence2.name = 'sence2'

        let sence3 = new PIXI.Container()
        sence3.position.set(0, 0)
        sence3.name = 'sence3'

        let sence4 = new PIXI.Container()
        sence4.position.set(0, 0)
        sence4.name = 'sence4'

        let sence5 = new PIXI.Container()
        sence5.position.set(0, 0)
        sence5.name = 'sence5'

        let sence6 = new PIXI.Container()
        sence6.position.set(0, 0)
        sence6.name = 'sence6'

        let sence7 = new PIXI.Container()
        sence7.position.set(0, 0)
        sence7.name = 'sence7'

        let sence8 = new PIXI.Container()
        sence8.position.set(0, 0)
        sence8.name = 'sence8'

        let sence9 = new PIXI.Container()
        sence9.position.set(0, 0)
        sence9.name = 'sence9'


        spriteGroupSences.addChild(sence1)
        spriteGroupSences.addChild(sence2)
        spriteGroupSences.addChild(sence3)
        spriteGroupSences.addChild(sence4)
        spriteGroupSences.addChild(sence5)
        spriteGroupSences.addChild(sence6)
        spriteGroupSences.addChild(sence7)
        spriteGroupSences.addChild(sence8)
        spriteGroupSences.addChild(sence9)


        function setBgPos(spr, ratio = 1) {
            if (img_height < height && img_width < width) {
                spr.scale.set(width / img_width * ratio, height / img_height * ratio)

            } else if (img_height < height) {
                // 当前图片高度小于屏幕高度，宽度大于屏幕宽度，需要按照高度进行等比例放大，放大后高度正好就是屏幕的高度，宽度需要设置偏移量
                spr.scale.set(height / img_height * ratio, height / img_height * ratio)
                spr.x = -parseInt((img_width * (height / img_height) - width) / 2)
                spr.y = 0

            } else if (img_width < width) {
                // 当前图片宽度小于屏幕宽度，高度大于屏幕高度，需要按照宽度进行等比例放大，放大后宽度正好就是屏幕的高度，高度需要设置偏移量
                spr.scale.set(width / img_width * ratio, width / img_width * ratio)
                spr.x = 0
                spr.y = -parseInt((img_height * (width / img_width) - height) / 2)

            } else {
                spr.x = -offsetLeft
                spr.y = -offsetTop
                spr.scale.set(ratio, ratio)
            }
            return spr
        }
        function startPage1(forward, page) {
            $('#stage1').removeClass('no-show')
            if (forward) {

            } else {
                app.stage.getChildByName('spriteGroupSences').getChildByName(`sence${page + 1}`).children = []
                app.stage.getChildByName('spriteGroupSences').getChildByName(`sence${page}`).children = []
            }
            document.getElementById('stage1').appendChild(app.view)
            canTouch = false
            let spr = new PIXI.Sprite.fromImage('imgs/scene1/bg@2x.png')

            if (img_height < height && img_width < width) {
                spr.scale.set(width / img_width, height / img_height)
                flag = '3'
            } else if (img_height < height) {
                // 当前图片高度小于屏幕高度，宽度大于屏幕宽度，需要按照高度进行等比例放大，放大后高度正好就是屏幕的高度，宽度需要设置偏移量
                spr.scale.set(height / img_height, height / img_height)
                spr.x = -parseInt((img_width * (height / img_height) - width) / 2)
                spr.y = 0
                flag = '1'
            } else if (img_width < width) {
                // 当前图片宽度小于屏幕宽度，高度大于屏幕高度，需要按照宽度进行等比例放大，放大后宽度正好就是屏幕的高度，高度需要设置偏移量
                spr.scale.set(width / img_width, width / img_width)
                spr.x = 0
                spr.y = -parseInt((img_height * (width / img_width) - height) / 2)
                flag = '2'
            } else {
                spr.x = -offsetLeft
                spr.y = -offsetTop
                flag = '0'
            }
            spr.name = 'sence1'

            // let logo_left = new PIXI.Sprite.fromImage('imgs/scene1/logo-left@1x.png')
            // logo_left.x = parseInt(0.03 * width)
            // logo_left.y = parseInt(0.05 * height)

            // let logo_right = new PIXI.Sprite.fromImage('imgs/scene1/logo-right@1x.png')
            // logo_right.x = parseInt(width - 116 - parseInt(0.03 * width))
            // logo_right.y = parseInt(0.05 * height)

            cloud_left = new PIXI.Sprite.fromImage('imgs/scene1/cloud-left.png')
            cloud_left.x = parseInt((width - progress_width) / 2) - 30
            cloud_left.y = parseInt(0.74 * height) - 10
            cloud_left.zOrder = 6

            cloud_right = new PIXI.Sprite.fromImage('imgs/scene1/cloud-right.png')
            cloud_right.x = parseInt((width - progress_width) / 2 + progress_width - 100) + 30
            cloud_right.y = parseInt(0.74 * height) - 10
            cloud_right.zOrder = 6

            progress = new PIXI.Sprite.fromImage('imgs/scene1/progress.png')
            progress.x = parseInt((width - progress_width) / 2)
            progress.y = parseInt(0.74 * height)
            progress.zOrder = 4
            progress.scale.set(progress_width / 512, 1)

            progress_dynamic = new PIXI.Sprite.fromImage('imgs/scene1/Progress@1x.png')
            progress_dynamic.x = parseInt((width - progress_width) / 2)
            progress_dynamic.y = parseInt(0.74 * height) + 1

            progress_dynamic.zOrder = 5
            progress_dynamic.scale.set(0, 0.9285)

            login_button = new PIXI.Sprite.fromImage('imgs/scene1/button@1x.png')
            if (flag === '0') {
                login_button.y = 471 - offsetTop
                login_button.x = parseInt((width - 167) / 2)
            } else if (flag === '1') {
                let ratio = height / img_height
                login_button.scale.set(ratio, ratio)
                login_button.y = height * 0.735
                login_button.x = parseInt((width - 167 * ratio) / 2)
            } else if (flag === '2') {
                let ratio = width / img_width
                login_button.scale.set(ratio, ratio)
                login_button.y = 471 * ratio - offsetTop
                login_button.x = parseInt((width - 167 * ratio) / 2)

            } else {
                login_button.scale.set(width / img_width, height / img_height)
                login_button.x = parseInt((width - 167 * (width / img_width)) / 2)
                login_button.y = height * 0.735
            }



            login_button.interactive = true
            // 精灵添加点击事件
            login_button.on("pointerdown", e => {
                startBill(true, 2)
            })

            let title = new PIXI.Sprite.fromImage('imgs/scene1/title@2x.png')

            if (flag === '0') {
                title.x = parseInt((width - 312) / 2)
                title.y = 201 - offsetTop - 100
            } else if (flag === '1') {
                let ratio = height / img_height
                title.scale.set(ratio, ratio)
                title.y = height * 0.158
                title.x = parseInt((width - 312 * ratio) / 2)
            } else if (flag === '2') {
                let ratio = width / img_width
                title.scale.set(ratio, ratio)
                title.y = 201 - offsetTop - 100
                title.x = parseInt((width - 312 * ratio) / 2)

            } else {
                title.scale.set(width / img_width, height / img_height)
                title.x = parseInt((width - 312 * (width / img_width)) / 2)
                title.y = height * 0.158
            }

            // 闪光序列帧
            let sence1_light = []
            for (let i = 0; i < light_imgs.length; i++) {
                let temp = new PIXI.Texture.fromImage(light_imgs[i])

                sence1_light.push(temp);
            }
            // 创建一个动画序列帧
            let animatedSprite = new PIXI.extras.AnimatedSprite(sence1_light);
            // 设置位置
            animatedSprite.x = parseInt((width - 312) / 2 - 50);
            animatedSprite.y = parseInt(0.09 * height);
            animatedSprite.animationSpeed = 0.3; // 动画播放的速度，默认为1,每秒播放60张图片
            // animatedSprite.setTransform(0, 0, width / img_width, height / img_height)
            animatedSprite.loop = true; // 动画是否循环
            animatedSprite.gotoAndPlay(0); // 从第几帧开始播放


            let sprites = app.stage.getChildByName('spriteGroupSences').getChildByName('sence1')
            sprites.addChild(spr)
            // sprites.addChild(logo_left)
            // sprites.addChild(logo_right)


            if (forward) {
                sprites.addChild(progress)
                sprites.addChild(progress_dynamic)
                sprites.addChild(cloud_left)
                sprites.addChild(cloud_right)
            } else {
                sprites.addChild(login_button)
            }

            sprites.addChild(title)
            // 第一个场景所有素材加载完毕
            sprites.addChild(animatedSprite)

            $('.stage2-text1').addClass('no-show')
        }


        startPage1(true, 1)
        // 设置文字位置
        $('.stage1-text1').css({
            top: `${parseInt(0.74 * height) - 45}px`,
        })
        $('.stage1-text2').css({
            top: `${parseInt(0.74 * height) + 45}px`,
        })


        for (let i = 53; i < 135; i++) {
            if (i % 2 == 0 || i === 53) {
                transfer_1to2.push('./imgs/transfer_1to2/' + 'Transfer1_' + i.toString().padStart(5, 0) + '.jpg')
            }

        }
        let robot_imgs = [

        ]
        for (let i = 25; i < 75; i++) {
            robot_imgs.push('./imgs/scene2/' + 'robot_' + i.toString().padStart(5, 0) + '.png')
        }
        let slide_imgs = []
        for (let i = 259; i < 291; i++) {
            slide_imgs.push('./imgs/scene2/' + 'Slide_' + i.toString().padStart(5, 0) + '.png')
        }
        let scene3_imgs = [
            './imgs/scene3/bg@1x.png'
        ]
        let scene4_imgs = [
            './imgs/scene4/bg@2x.png'
        ]
        let scene5_imgs = [
            './imgs/scene5/bg@1x.png',
            './imgs/scene5/icon1.png',
            './imgs/scene5/icon2.png',
            './imgs/scene5/icon3.png',
            './imgs/scene5/icon4.png',
        ]
        let scene6_imgs = [
            './imgs/scene6/bg@1x.png'
        ]
        let scene7_imgs = [
            './imgs/scene7/bg@1x.png'
        ]
        let scene8_imgs = [
            './imgs/scene8/bg-sigle@1x.png'
        ]
        let scene9_imgs = [
            './imgs/scene9/pc.png'
        ]

        all_imgs.push(...transfer_1to2, ...slide_imgs, ...robot_imgs, ...scene3_imgs, ...scene4_imgs, ...scene5_imgs, ...scene6_imgs, ...scene7_imgs, ...scene8_imgs, ...scene9_imgs)
        let count_img_already = 0

        PIXI.loader
            .add(all_imgs)
            .on('progress', (loader) => {
                count_img_already += 1

                progress_dynamic.scale.set((count_img_already / all_imgs.length) * (progress_width / 512), 0.9285)
                let number_progress = ((count_img_already / all_imgs.length).toFixed(2) * 100).toString()

                if (number_progress.length > 3) {
                    number_progress = number_progress.slice(0, 2)
                }
                console.log(number_progress)
                $('.stage1-text2').html(`人物穿越进度  ${number_progress}%`)
            }).load(() => {
    // 清楚单个精灵
    sprites = app.stage.getChildByName('spriteGroupSences').getChildByName('sence1')
    sprites.removeChild(cloud_left)
                sprites.removeChild(cloud_right)
                sprites.removeChild(progress)
                sprites.removeChild(progress_dynamic)
                $('.stage1-text1').addClass('no-show')
                $('.stage1-text2').addClass('no-show')
                sprites.addChild(login_button)
            })

        // 开启账单点击事件
        function startBill(forward, page) {
            canTouch = false
            $('#stage1').addClass('no-show')
            $('#stage2').removeClass('no-show')
            if (forward) {
                app.stage.getChildByName('spriteGroupSences').getChildByName(`sence${page - 1}`).children = []
            } else {
                app.stage.getChildByName('spriteGroupSences').getChildByName(`sence${page + 1}`).children = []
            }

            let sence2_imgs = []

            for (let i = 0; i < transfer_1to2.length; i++) {
                let temp = new PIXI.Texture.fromImage(transfer_1to2[i])
                sence2_imgs.push(temp);
            }
            document.getElementById('stage2').appendChild(app.view)
            // 场景2 创建一个动画序列帧
            let animatedSprite = new PIXI.extras.AnimatedSprite(sence2_imgs);

            if (img_height < height && img_width < width) {
                animatedSprite.scale.set((width / img_width) / 2, (height / img_height) / 2)
            } else if (img_height < height) {
                // 当前图片高度小于屏幕高度，宽度大于屏幕宽度，需要按照高度进行等比例放大，放大后高度正好就是屏幕的高度，宽度需要设置偏移量
                animatedSprite.scale.set((height / img_height) / 2, (height / img_height) / 2)
                animatedSprite.x = -parseInt((img_width * (height / img_height) - width) / 2)
                animatedSprite.y = 0
            } else if (img_width < width) {
                // 当前图片宽度小于屏幕宽度，高度大于屏幕高度，需要按照宽度进行等比例放大，放大后宽度正好就是屏幕的高度，高度需要设置偏移量
                animatedSprite.scale.set((width / img_width) / 2, (width / img_width) / 2)
                animatedSprite.x = 0
                animatedSprite.y = -parseInt((img_height * (width / img_width) - height) / 2)
            } else {
                animatedSprite.x = -offsetLeft
                animatedSprite.y = -offsetTop
                animatedSprite.scale.set(0.5, 0.5)
            }
            // 设置位置
            // animatedSprite.x = 0;
            // animatedSprite.y = 0;

            animatedSprite.animationSpeed = 0.4; // 动画播放的速度，默认为1,每秒播放60张图片
            // animatedSprite.setTransform(0, 0, width / 750, height / 1620)
            animatedSprite.loop = false; // 动画是否循环
            animatedSprite.onComplete = () => {
                console.log("播放完成");
                canTouch = true
                $('.stage2-text1').css({
                    top: `${parseInt(0.15 * height)}px`,

                })

                $('.stage2-text1').html(`如果说上云，是你旅居新的城市<br/>
                云化，是你开始适应这新的生活<br/><br/>
                那从什么时候开始<br/>
                你真正成为这座城市的居民？`)
                $('.stage2-text1').removeClass('no-show')
                // 机器人 动画
                let robots = []
                for (let i = 0; i < robot_imgs.length; i++) {
                    let temp = new PIXI.Texture.fromImage(robot_imgs[i])
                    robots.push(temp);
                }
                let animated_robots = new PIXI.extras.AnimatedSprite(robots);
                animated_robots.animationSpeed = 0.5; // 动画播放的速度，默认为1,每秒播放60张图片
                animated_robots.loop = true; // 动画是否循环
                animated_robots.x = parseInt(width / 2) + 90
                animated_robots.y = parseInt(height * 0.45) + 106
                animated_robots.scale.set(0.5, 0.5)
                app.stage.getChildByName('spriteGroupSences').getChildByName('sence2').addChild(animated_robots)
                animated_robots.gotoAndPlay(0)

                // 机器人对话框
                $('.stage2-dialog').removeClass('no-show')
                $('.stage2-dialog').css({
                    top: '45%',
                    left: `${parseInt((width - 285) / 2)}px`,
                })
                // 对话框文字部分
                let text_dialog = ['Hi 张平安，我叫凌小云，是你的云上生活助理', '跟着我，来看看你在这里的‘原生生活指数’吧']
                let count_round = 0
                let count_one = 0
                let timer_dialog = setInterval(() => {
                    count_one++

                    if (count_one > text_dialog[count_round].length) {
                        count_one = 0
                        count_round++
                        if (count_round >= text_dialog.length) {
                            clearInterval(timer_dialog)
                            // 提示上下滑动动画
                            let slides = []
                            for (let i = 0; i < slide_imgs.length; i++) {
                                let temp = new PIXI.Texture.fromImage(slide_imgs[i])
                                slides.push(temp);
                            }
                            let animated_slides = new PIXI.extras.AnimatedSprite(slides);
                            animated_slides.animationSpeed = 0.5; // 动画播放的速度，默认为1,每秒播放60张图片
                            // animatedSprite.setTransform(0, 0, width / 750, height / 1620)
                            animated_slides.scale.set(0.5, 0.5)
                            animated_slides.loop = true; // 动画是否循环
                            animated_slides.x = parseInt((width - 34) / 2)
                            animated_slides.y = parseInt(0.63 * height)

                            app.stage.getChildByName('spriteGroupSences').getChildByName('sence2').addChild(animated_slides)
                            animated_slides.gotoAndPlay(0)
                        } else {
                            $('.stage2-dialog-text').html(``)
                        }

                    } else {
                        $('.stage2-dialog-text').html(`${text_dialog[count_round].slice(0, count_one)}`)
                    }

                }, 100)






            }; // 动画完成的回调函数
            let sprites2 = app.stage.getChildByName('spriteGroupSences').getChildByName('sence2')
            sprites2.addChild(animatedSprite)

            animatedSprite.gotoAndPlay(0); // 从第几帧开始播放


            function startPage3(forward, page) {
                state = 'state3_start'
                // 设置第三页背景
                $('#stage3').removeClass('no-show')
                if (forward) {
                    app.stage.getChildByName('spriteGroupSences').getChildByName(`sence${page - 1}`).children = []
                } else {
                    app.stage.getChildByName('spriteGroupSences').getChildByName(`sence${page + 1}`).children = []
                }
                document.getElementById('stage3').appendChild(app.view)
                spr = new PIXI.Sprite.fromImage(scene3_imgs[0])
                spr = setBgPos(spr)
                spr.name = 'sence3'
                let sprites = app.stage.getChildByName('spriteGroupSences').getChildByName('sence3')

                sprites.addChild(spr)

                $('.stage2-text1').addClass('no-show')

                // 设置文字渐出效果
                $('.stage3-text1').css({
                    top: `${parseInt(0.15 * height)}px`,

                })
                let text3 = [
                    '2023年8月13日<br/>你开启了云上之城的新生活<br/>距今已经241天<br/>不知是否已经习惯这里',
                    '2023,你在Starlink共活跃176天<br/>从第一次参与的项目开始<br/>你为5个项目做出杰出贡献<br/>以下是你参与最多的事务',
                ]
                let text3_round = 0
                $('.stage3-text1').addClass('no-show')
                $('.stage3-text1').html(text3[text3_round])
                $('.stage3-text1').css({
                    top: `${parseInt(0.15 * height)}px`,
                    'animation': 'fade-in 4s ease 0s 2',
                    'animation-fill-mode': 'forwards'
                })
                $('.stage3-text1').removeClass('no-show')
                text3_round++
                let text3_timer = setInterval(() => {
                    if (text3_round >= text3.length) {
                        clearInterval(text3_timer)
                        state = 'state3_end'
                        // 绘制工时统计图表
                        $('.stage3-echarts').css({
                            width: `${parseInt(width / 2)}px`,
                            height: '300px',
                            left: `${parseInt(width / 4)}px`,
                            bottom: '60px',
                        })
                        $('.stage3-echarts').removeClass('no-show')

                        let chartDom = document.getElementsByClassName('stage3-echarts')[0];

                        let myChart = echarts.init(chartDom);
                        let option;

                        option = {
                            backgroundColor: 'rgba(255, 255, 255, 0.3)', //rgba设置透明度0.1
                            xAxis: {
                                type: 'category',
                                data: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun']
                            },
                            yAxis: {
                                type: 'value'
                            },
                            series: [
                                {
                                    data: [120, 200, 150, 80, 70, 110, 130],
                                    type: 'bar',
                                    showBackground: false,
                                    backgroundStyle: {
                                        color: 'rgba(180, 180, 180, 0.7)'
                                    }
                                }
                            ]
                        };

                        option && myChart.setOption(option);

                    }
                    $('.stage3-text1').addClass('no-show')
                    $('.stage3-text1').html(text3[text3_round])
                    $('.stage3-text1').css({
                        top: `${parseInt(0.15 * height)}px`,
                    })
                    $('.stage3-text1').removeClass('no-show')
                    text3_round++
                }, 4000)


            }
            function endPage3() {
                state = 'state3_end'
                // 设置第三页背景
                app.stage.getChildByName('spriteGroupSences').getChildByName(`sence3`).children = []
                document.getElementById('stage3').appendChild(app.view)
                spr = new PIXI.Sprite.fromImage(scene3_imgs[0])
                spr = setBgPos(spr)
                spr.name = 'sence3'
                let sprites = app.stage.getChildByName('spriteGroupSences').getChildByName('sence3')
                sprites.addChild(spr)

                // 设置文字渐出效果

                let text3 = [
                    '2023,你在Starlink共活跃176天<br/>从第一次参与的项目开始<br/>你为5个项目做出杰出贡献<br/>以下是你参与最多的事务',
                ]


                $('.stage3-text1').html(text3[0])
                $('.stage3-text1').css({
                    top: `${parseInt(0.15 * height)}px`,
                    'animation': 'unset',
                    'animation-fill-mode': 'unset',
                    'opacity': '1',
                })
                // 绘制工时统计图表
                $('.stage3-echarts').css({
                    width: `${parseInt(width / 2)}px`,
                    height: '300px',
                    left: `${parseInt(width / 4)}px`,
                    bottom: '60px',
                })
                $('.stage3-echarts').removeClass('no-show')

                let chartDom = document.getElementsByClassName('stage3-echarts')[0];

                let myChart = echarts.init(chartDom);
                let option;

                option = {
                    backgroundColor: 'rgba(255, 255, 255, 0.3)', //rgba设置透明度0.1
                    xAxis: {
                        type: 'category',
                        data: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun']
                    },
                    yAxis: {
                        type: 'value'
                    },
                    series: [
                        {
                            data: [120, 200, 150, 80, 70, 110, 130],
                            type: 'bar',
                            showBackground: false,
                            backgroundStyle: {
                                color: 'rgba(180, 180, 180, 0.7)'
                            }
                        }
                    ]
                };

                option && myChart.setOption(option);

            }
            function startPage4(forward, page) {

                $('#stage4').removeClass('no-show')
                if (forward) {
                    app.stage.getChildByName('spriteGroupSences').getChildByName(`sence${page - 1}`).children = []
                } else {
                    app.stage.getChildByName('spriteGroupSences').getChildByName(`sence${page + 1}`).children = []
                }
                document.getElementById('stage4').appendChild(app.view)
                spr = new PIXI.Sprite.fromImage(scene4_imgs[0])
                spr = setBgPos(spr, 1)
                spr.name = 'sence4'
                let sprites = app.stage.getChildByName('spriteGroupSences').getChildByName('sence4')
                sprites.addChild(spr)

                // 设置文字效果
                $('.stage4-text1').css({
                    top: `${parseInt(0.15 * height)}px`,

                })
                let text4 = [
                    '地上一年，云上只一天<br/>云上的节奏，是持续迭代，敏捷高效<br/>2023，你作为前端开发<br/>参与169个版本的发布<br/>18天是你常见的迭代周期<br/>贡献了125行代码',
                    '2023,你在Starlink共活跃176天<br/>从第一次参与的项目开始<br/>你为5个项目做出杰出贡献<br/>以下是你参与最多的事务',
                ]
                let text4_round = 0
                $('.stage4-text1').addClass('no-show')
                $('.stage4-text1').html(text4[text4_round])
                $('.stage4-text1').css({
                    top: `${parseInt(0.15 * height)}px`,
                })
                $('.stage4-text1').removeClass('no-show')
                text4_round++
                let text4_timer = setInterval(() => {
                    if (text4_round >= text4.length) {
                        clearInterval(text4_timer)

                    }
                    $('.stage4-text1').addClass('no-show')
                    $('.stage4-text1').html(text4[text4_round])
                    $('.stage4-text1').css({
                        top: `${parseInt(0.15 * height)}px`,
                    })
                    $('.stage4-text1').removeClass('no-show')
                    text4_round++
                }, 4000)
            }

            function startPage5(forward, page) {

                $('#stage5').removeClass('no-show')
                if (forward) {
                    app.stage.getChildByName('spriteGroupSences').getChildByName(`sence${page - 1}`).children = []
                } else {
                    app.stage.getChildByName('spriteGroupSences').getChildByName(`sence${page + 1}`).children = []
                }
                document.getElementById('stage5').appendChild(app.view)
                spr = new PIXI.Sprite.fromImage(scene5_imgs[0])
                spr = setBgPos(spr)
                spr.name = 'sence5'
                let sprites = app.stage.getChildByName('spriteGroupSences').getChildByName('sence5')
                sprites.addChild(spr)
                // 设置文字
                $('.stage5-text1').css({
                    top: `${parseInt(0.15 * height)}px`,

                })
                let text5 = [
                    '在云上，人与人之间的链接无处不在<br/>我们坚信，只有并肩携手，从能共赴星海<br/><br/>2023你与5人一起<br/>在3个应用上密切合作<br/><br/>别忘了和他们击个掌<br/>这些应用，因为你的付出而更加可靠',
                ]
                let text5_round = 0
                $('.stage5-text1').addClass('no-show')
                $('.stage5-text1').html(text5[text5_round])
                $('.stage5-text1').css({
                    animation: `fade-in 4s ease 0s ${text5.length}`,
                    top: `${parseInt(0.15 * height)}px`,
                    'animation-fill-mode': 'forwards',
                })
                $('.stage5-text1').removeClass('no-show')
                text5_round++
                let text5_timer = setInterval(() => {
                    if (text5_round >= text5.length) {
                        clearInterval(text5_timer)
                    }
                    $('.stage5-text1').addClass('no-show')
                    $('.stage5-text1').html(text5[text5_round])
                    $('.stage5-text1').css({
                        top: `${parseInt(0.15 * height)}px`,

                    })
                    $('.stage5-text1').removeClass('no-show')
                    text5_round++
                }, 4000)


                // 设置动态弹幕
                function randomNum(minNum, maxNum) {
                    switch (arguments.length) {
                        case 1:
                            return parseInt(Math.random() * minNum + 1, 10);
                            break;
                        case 2:
                            return parseInt(Math.random() * (maxNum - minNum + 1) + minNum, 10);
                            break;
                        default:
                            return 0;
                            break;
                    }
                }
                let times = 2000
                let min_height = 20
                let max_height = 200
                let interval = 1000
                let cur_count = 0
                timer_dynamic = setInterval(() => {
                    let temp = null
                    if (cur_count % 10 === 0) {
                        temp = new PIXI.Text('王星', new PIXI.TextStyle({
                            'fill': '#ffffff',
                            'fontSize': '1.5rem'
                        }))
                    } else if (cur_count % 9 === 0) {
                        temp = new PIXI.Text('A101435', new PIXI.TextStyle({
                            'fill': '#ffffff',
                            'fontSize': '1.5rem'
                        }))
                    } else {
                        temp = new PIXI.Sprite.fromImage(`${scene5_imgs[randomNum(1, 4)]}`)
                        temp.scale.set(0.25, 0.25)
                    }


                    temp.x = width
                    temp.y = randomNum(min_height, max_height)
                    temp.name = 'sence5'
                    app.stage.getChildByName('spriteGroupSences').getChildByName('sence5').addChild(temp)
                    cur_count += 1
                    if (cur_count > times) {
                        clearInterval(timer_dynamic)
                    }
                    setInterval(() => {
                        temp.x -= 10
                    }, 100)
                }, interval)


            }

    function startPage6(forward, page) {

        $('#stage6').removeClass('no-show')
        if (forward) {
            app.stage.getChildByName('spriteGroupSences').getChildByName(`sence${page - 1}`).children = []
        } else {
            app.stage.getChildByName('spriteGroupSences').getChildByName(`sence${page + 1}`).children = []
        }
        document.getElementById('stage6').appendChild(app.view)
        spr = new PIXI.Sprite.fromImage(scene6_imgs[0])
        spr = setBgPos(spr)
        spr.name = 'sence6'
        let sprites = app.stage.getChildByName('spriteGroupSences').getChildByName('sence6')
        sprites.addChild(spr)

                // 设置文字
                $('.stage6-text1').css({
                    top: `${parseInt(0.15 * height)}px`,

                })
                let text6 = [
                    '你知道吗?<br/>除了你能看见的战友<br/>还有更多在你背后默默支持你的“云友”<br/><br/>2023，14个接口<br/>为你的工作提供必不可少的支持<br/>8个组件<br/>在你的应用/项目中持续赋能<br/><br/>这些能力的背后<br/>是111位和你怀揣同样憧憬的人',
                ]
                let text6_round = 0
                $('.stage6-text1').addClass('no-show')
                $('.stage6-text1').html(text6[text6_round])
                $('.stage6-text1').css({
                    animation: `fade-in 4s ease 0s ${text6.length}`,
                    top: `${parseInt(0.15 * height)}px`,
                    'animation-fill-mode': 'forwards',
                })
                $('.stage6-text1').removeClass('no-show')
                text6_round++
                let text6_timer = setInterval(() => {
                    if (text6_round >= text6.length) {
                        clearInterval(text6_timer)
                    }
                    $('.stage6-text1').addClass('no-show')
                    $('.stage6-text1').html(text6[text6_round])
                    $('.stage6-text1').css({
                        top: `${parseInt(0.15 * height)}px`,

                    })
                    $('.stage6-text1').removeClass('no-show')
                    text6_round++
                }, 4000)
            }

            function startPage7(forward, page) {
                $('#stage7').removeClass('no-show')
                if (forward) {
                    app.stage.getChildByName('spriteGroupSences').getChildByName(`sence${page - 1}`).children = []
                } else {
                    app.stage.getChildByName('spriteGroupSences').getChildByName(`sence${page + 1}`).children = []
                }
                document.getElementById('stage7').appendChild(app.view)
                let spr = new PIXI.Sprite.fromImage(scene7_imgs[0])
                spr = setBgPos(spr)
                spr.name = 'sence7'
                let sprites = app.stage.getChildByName('spriteGroupSences').getChildByName('sence7')
                sprites.addChild(spr)

                // 设置文字
                $('.stage7-text1').css({
                    top: `${parseInt(0.15 * height)}px`,

                })
                let text7 = [
                    '你注意到了吗？<br/>为了让云上的生活更加轻松<br/>在你身边，改变在悄然发生',
                    '2023，在与你有关的应用中<br/>有5个应用<br/>完成了微服务化改造<br/>有17个应用<br/>完成了容器化改造<br/>有8个应用<br/>完成了容器化改造<br/><br/>9个应用进行了11项云原生化治理'
                ]
                let text7_round = 0
                $('.stage7-text1').addClass('no-show')
                $('.stage7-text1').html(text7[text7_round])
                $('.stage7-text1').css({
                    animation: `fade-in 4s ease 0s ${text7.length}`,
                    top: `${parseInt(0.15 * height)}px`,
                    'animation-fill-mode': 'forwards',
                })
                $('.stage7-text1').removeClass('no-show')
                text7_round++
                let text7_timer = setInterval(() => {
                    if (text7_round >= text7.length) {
                        clearInterval(text7_timer)
                    }
                    $('.stage7-text1').addClass('no-show')
                    $('.stage7-text1').html(text7[text7_round])
                    $('.stage7-text1').css({
                        top: `${parseInt(0.15 * height)}px`,

                    })
                    $('.stage7-text1').removeClass('no-show')
                    text7_round++
                }, 4000)
            }

            function startPage8(forward, page) {
                $('#stage8').removeClass('no-show')
                if (forward) {
                    app.stage.getChildByName('spriteGroupSences').getChildByName(`sence${page - 1}`).children = []
                } else {
                    app.stage.getChildByName('spriteGroupSences').getChildByName(`sence${page + 1}`).children = []
                }
                document.getElementById('stage8').appendChild(app.view)
                let spr = new PIXI.Sprite.fromImage(scene8_imgs[0])
                spr = setBgPos(spr)
                spr.name = 'sence8'
                let sprites = app.stage.getChildByName('spriteGroupSences').getChildByName('sence8')
                sprites.addChild(spr)

                // 设置文字
                $('.stage8-text1').css({
                    top: `${parseInt(0.15 * height)}px`,

                })
                let text8 = [
                    '你成为这个城市的一份子<br/>是从你开始理解和接受这个城市的理念<br/>是你学着高效利用这里的每一处基础设施<br/>是慢慢开始用这个城市“原生”的方式生活<br/>和这座城市共同成就开始的<br/><br/>2023，是云上的第一年<br/>也是我们奔赴星辰大海的里程碑<br/>点击生成你的“云上生活档案”',
                ]
                let text8_round = 0
                $('.stage8-text1').addClass('no-show')
                $('.stage8-text1').html(text8[text8_round])
                $('.stage8-text1').css({
                    animation: `fade-in 4s ease 0s ${text8.length}`,
                    top: `${parseInt(0.15 * height)}px`,
                    'animation-fill-mode': 'forwards',
                })
                $('.stage8-text1').removeClass('no-show')
                text8_round++
                let text8_timer = setInterval(() => {
                    if (text8_round >= text8.length) {
                        clearInterval(text8_timer)
                    }
                    $('.stage8-text1').addClass('no-show')
                    $('.stage8-text1').html(text8[text8_round])
                    $('.stage8-text1').css({
                        top: `${parseInt(0.15 * height)}px`,

                    })
                    $('.stage8-text1').removeClass('no-show')
                    text8_round++
                }, 4000)
            }

            function startPage9(forward, page) {
                $('#stage9').removeClass('no-show')
                if (forward) {
                    app.stage.getChildByName('spriteGroupSences').getChildByName(`sence${page - 1}`).children = []
                }
                document.getElementById('stage9').appendChild(app.view)
                let spr = new PIXI.Sprite.fromImage('imgs/scene9/pc.png')
                spr = setBgPos(spr)
                spr.name = 'sence9'
                let sprites = app.stage.getChildByName('spriteGroupSences').getChildByName('sence9')
                sprites.addChild(spr)
            }

            // 滑动监听事件
            let [endY, diff] = [0, 0]

            let curPage = 2
            let PageL = 10
            document.body.addEventListener("touchstart", touchStart, { passive: false });
            document.body.addEventListener("touchmove", touchMove, { passive: false });
            document.body.addEventListener("touchend", touchEnd, { passive: false });
            function touchStart(e) {
                var touch = e.touches[0];
                startY = touch.pageY;
            }
            function touchMove(e) {
                //e.preventDefault();
                var touch = e.touches[0];
                endY = touch.pageY;
                diff = endY - startY;
            }

            function touchEnd(e) {
                // diff 负数往下滑动
                if (Math.abs(diff) > 10 && canTouch) {
                    if (diff > 0) {
                        // 向前翻页
                        if (curPage <= 1) {
                            return;
                        }
                        curPage--;
                        console.log(curPage)
                        switch (curPage) {
                            case 1:

                                [endY, diff] = [0, 0]

                                curPage = 2
                                PageL = 10
                                document.body.removeEventListener("touchStart", touchStart);
                                document.body.removeEventListener("touchMove", touchMove);
                                document.body.removeEventListener("touchend", touchEnd);
                                $('#stage2').addClass('no-show')
                                $('.stage2-dialog').addClass('no-show')
                                startPage1(false, curPage)
                                break
                            case 2:
                                $('#stage3').addClass('no-show')
                                $('.stage3-echarts').addClass('no-show')
                                startBill(false, curPage)
                                break
                            case 3:
                                $('#stage4').addClass('no-show')
                                startPage3(false, curPage)
                                break
                            case 4:
                                timer_dynamic && clearInterval(timer_dynamic)
                                $('#stage5').addClass('no-show')
                                startPage4(false, curPage)
                                break
                            case 5:
                                $('#stage6').addClass('no-show')
                                startPage5(false, curPage)
                                break
                            case 6:
                                $('#stage7').addClass('no-show')
                                startPage6(false, curPage)
                                break
                            case 7:
                                $('#stage8').addClass('no-show')
                                startPage7(false, curPage)
                                break
                            case 8:
                                $('#stage9').addClass('no-show')
                                startPage8(false, curPage)
                                break

                        }


                    } else {
                        // 向后翻页
                        if (curPage >= PageL) {
                            return;
                        }
                        curPage++;
                        switch (curPage) {
                            case 3:
                                $('#stage2').addClass('no-show')
                                $('.stage2-dialog').addClass('no-show')
                                startPage3(true, curPage)
                                break
                            case 4:
                                if (state === 'state3_start') {
                                    curPage = 3
                                    endPage3()
                                } else {
                                    $('#stage3').addClass('no-show')
                                    $('.stage3-echarts').addClass('no-show')
                                    startPage4(true, curPage)
                                }

                                break
                            case 5:
                                $('#stage4').addClass('no-show')
                                startPage5(true, curPage)
                                break
                            case 6:
                                timer_dynamic && clearInterval(timer_dynamic)
                                $('#stage5').addClass('no-show')
                                startPage6(true, curPage)
                                break
                            case 7:
                                $('#stage6').addClass('no-show')
                                startPage7(true, curPage)
                                break
                            case 8:
                                $('#stage7').addClass('no-show')
                                startPage8(true, curPage)
                                break
                            case 9:
                                $('#stage8').addClass('no-show')
                                startPage9(true, curPage)
                                break
                            case 10:
                                curPage = 9
                                break
                        }


                    }

                }
            }
        
        
        }
    }



</script>

</html>